import{u as h,a as f,b as j,d as N,e as p,f as c,j as e,B as m,S as g,h as b,R as U,o as v,s as u,F as w,I as x}from"./index-D0mVz3ol.js";import{C as y}from"./ContentLayout-BPYlf98W.js";import{C as D,c as F,f as L,a as C,b as R,T as A}from"./format-D9jVc0G6.js";const P=()=>f.get("/users"),B=({config:s}={})=>h({...s,queryKey:["users"],queryFn:()=>P()}),Q=({userId:s})=>f.delete(`/users/${s}`),E=({config:s}={})=>{const{addNotification:t}=j(),a=N();return p({onMutate:async i=>{await a.cancelQueries(["users"]);const l=a.getQueryData(["users"]);return a.setQueryData(["users"],l==null?void 0:l.filter(r=>r.id!==i.userId)),{previousUsers:l}},onError:(i,l,r)=>{r!=null&&r.previousUsers&&a.setQueryData(["users"],r.previousUsers)},onSuccess:()=>{a.invalidateQueries(["users"]),t({type:"success",title:"User Deleted"})},...s,mutationFn:Q})},I=({id:s})=>{var i;const t=c(),a=E();return((i=t.data)==null?void 0:i.id)===s?null:e.jsx(D,{icon:"danger",title:"Delete User",body:"Are you sure you want to delete this user?",triggerButton:e.jsx(m,{variant:"danger",children:"Delete"}),confirmButton:e.jsx(m,{isLoading:a.isLoading,type:"button",className:"bg-red-600",onClick:()=>a.mutate({userId:s}),children:"Delete User"})})},q=()=>{const s=B();return s.isLoading?e.jsx("div",{className:"w-full h-48 flex justify-center items-center",children:e.jsx(g,{size:"lg"})}):s.data?e.jsx(F,{data:s.data,columns:[{title:"First Name",field:"firstName"},{title:"Last Name",field:"lastName"},{title:"Email",field:"email"},{title:"Role",field:"role"},{title:"Created At",field:"createdAt",Cell({entry:{createdAt:t}}){return e.jsx("span",{children:L(t)})}},{title:"",field:"id",Cell({entry:{id:t}}){return e.jsx(I,{id:t})}}]}):null},K=()=>e.jsx(y,{title:"Users",children:e.jsx("div",{className:"mt-4",children:e.jsx(b,{forbiddenFallback:e.jsx("div",{children:"Only admin can view this."}),allowedRoles:[U.ADMIN],children:e.jsx(q,{})})})}),S=({data:s})=>f.patch("/users/profile",s),M=({config:s}={})=>{const{addNotification:t}=j(),{refetch:a}=c();return p({onSuccess:()=>{t({type:"success",title:"User Updated"}),a()},...s,mutationFn:S})},T=v({email:u().min(1,"Required"),firstName:u().min(1,"Required"),lastName:u().min(1,"Required"),bio:u()}),z=()=>{var a,i,l,r;const s=c(),t=M();return e.jsx(C,{isDone:t.isSuccess,triggerButton:e.jsx(m,{startIcon:e.jsx(R,{className:"w-4 h-4"}),size:"sm",children:"Update Profile"}),title:"Update Profile",submitButton:e.jsx(m,{form:"update-profile",type:"submit",size:"sm",isLoading:t.isLoading,children:"Submit"}),children:e.jsx(w,{id:"update-profile",onSubmit:async n=>{await t.mutateAsync({data:n})},options:{defaultValues:{firstName:(a=s.data)==null?void 0:a.firstName,lastName:(i=s.data)==null?void 0:i.lastName,email:(l=s.data)==null?void 0:l.email,bio:(r=s.data)==null?void 0:r.bio}},schema:T,children:({register:n,formState:d})=>e.jsxs(e.Fragment,{children:[e.jsx(x,{label:"First Name",error:d.errors.firstName,registration:n("firstName")}),e.jsx(x,{label:"Last Name",error:d.errors.lastName,registration:n("lastName")}),e.jsx(x,{label:"Email Address",type:"email",error:d.errors.email,registration:n("email")}),e.jsx(A,{label:"Bio",error:d.errors.bio,registration:n("bio")})]})})})},o=({label:s,value:t})=>e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:s}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t})]}),V=()=>{const s=c();return s.data?e.jsx(y,{title:"Profile",children:e.jsxs("div",{className:"overflow-hidden bg-white shadow sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"User Information"}),e.jsx(z,{})]}),e.jsx("p",{className:"max-w-2xl mt-1 text-sm text-gray-500",children:"Personal details of the user."})]}),e.jsx("div",{className:"px-4 py-5 border-t border-gray-200 sm:p-0",children:e.jsxs("dl",{className:"sm:divide-y sm:divide-gray-200",children:[e.jsx(o,{label:"First Name",value:s.data.firstName}),e.jsx(o,{label:"Last Name",value:s.data.lastName}),e.jsx(o,{label:"Email Address",value:s.data.email}),e.jsx(o,{label:"Role",value:s.data.role}),e.jsx(o,{label:"Bio",value:s.data.bio})]})})]})}):null};export{V as Profile,K as Users};
