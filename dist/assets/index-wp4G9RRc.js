import{r as u,u as f,a as l,b as m,d as h,e as y,j as s,B as c,f as A,S as b,h as j,P as B,M as N,o as D,s as d,F as p,R as C,I as Q,i as q,H as _,k,l as x,N as E}from"./index-D0mVz3ol.js";import{C as L}from"./ContentLayout-BPYlf98W.js";import{C as F,F as $,f as g,a as w,T as v,b as z,c as I}from"./format-D9jVc0G6.js";import{L as T}from"./Link-mjLZ8lwk.js";function U(e,t){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:t},e),u.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"}))}const R=u.forwardRef(U);function P(e,t){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:t},e),u.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}))}const M=u.forwardRef(P),H=({discussionId:e})=>l.get("/comments",{params:{discussionId:e}}),O=({discussionId:e,config:t})=>f({queryKey:["comments",e],queryFn:()=>H({discussionId:e}),...t}),K=({commentId:e})=>l.delete(`/comments/${e}`),V=({config:e,discussionId:t})=>{const{addNotification:i}=m(),n=h();return y({onMutate:async a=>{await n.cancelQueries(["comments",t]);const r=n.getQueryData(["comments",t]);return n.setQueryData(["comments",t],r==null?void 0:r.filter(o=>o.id!==a.commentId)),{previousComments:r}},onError:(a,r,o)=>{o!=null&&o.previousComments&&n.setQueryData(["comments",t],o.previousComments)},onSuccess:()=>{n.invalidateQueries(["comments",t]),i({type:"success",title:"Comment Deleted"})},...e,mutationFn:K})},W=({id:e,discussionId:t})=>{const i=V({discussionId:t});return s.jsx(F,{isDone:i.isSuccess,icon:"danger",title:"Delete Comment",body:"Are you sure you want to delete this comment?",triggerButton:s.jsx(c,{variant:"danger",size:"sm",startIcon:s.jsx(M,{className:"h-4 w-4"}),children:"Delete Comment"}),confirmButton:s.jsx(c,{isLoading:i.isLoading,type:"button",className:"bg-red-600",onClick:async()=>await i.mutateAsync({commentId:e}),children:"Delete Comment"})})},G=({discussionId:e})=>{var n;const t=A(),i=O({discussionId:e});return i.isLoading?s.jsx("div",{className:"flex items-center justify-center w-full h-48",children:s.jsx(b,{size:"lg"})}):(n=i==null?void 0:i.data)!=null&&n.length?s.jsx("ul",{"aria-label":"comments",className:"flex flex-col space-y-3",children:i.data.map((a,r)=>s.jsxs("li",{"aria-label":`comment-${a.body}-${r}`,className:"w-full p-4 bg-white shadow-sm",children:[s.jsx(j,{policyCheck:B["comment:delete"](t.data,a),children:s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-xs font-semibold",children:g(a.createdAt)}),a.author&&s.jsxs("span",{className:"text-xs font-bold",children:[" ","by ",a.author.firstName," ",a.author.lastName]})]}),s.jsx(W,{discussionId:e,id:a.id})]})}),s.jsx(N,{value:a.body})]},a.id||r))}):s.jsxs("div",{role:"list","aria-label":"comments",className:"flex flex-col items-center justify-center h-40 text-gray-500 bg-white",children:[s.jsx($,{className:"w-10 h-10"}),s.jsx("h4",{children:"No Comments Found"})]})},J=({data:e})=>l.post("/comments",e),X=({config:e,discussionId:t})=>{const{addNotification:i}=m(),n=h();return y({onMutate:async a=>{await n.cancelQueries(["comments",t]);const r=n.getQueryData(["comments",t]);return n.setQueryData(["comments",t],[...r||[],a.data]),{previousComments:r}},onError:(a,r,o)=>{o!=null&&o.previousComments&&n.setQueryData(["comments",t],o.previousComments)},onSuccess:()=>{n.invalidateQueries(["comments",t]),i({type:"success",title:"Comment Created"})},...e,mutationFn:J})},Y=D({body:d().min(1,"Required")}),Z=({discussionId:e})=>{const t=X({discussionId:e});return s.jsx(s.Fragment,{children:s.jsx(w,{isDone:t.isSuccess,triggerButton:s.jsx(c,{size:"sm",startIcon:s.jsx(R,{className:"h-4 w-4"}),children:"Create Comment"}),title:"Create Comment",submitButton:s.jsx(c,{isLoading:t.isLoading,form:"create-comment",type:"submit",size:"sm",disabled:t.isLoading,children:"Submit"}),children:s.jsx(p,{id:"create-comment",onSubmit:async i=>{await t.mutateAsync({data:{body:i.body,discussionId:e}})},schema:Y,children:({register:i,formState:n})=>s.jsx(v,{label:"Body",error:n.errors.body,registration:i("body")})})})})},ss=({discussionId:e})=>s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-1xl font-bold",children:"Comments:"}),s.jsx(Z,{discussionId:e})]}),s.jsx(G,{discussionId:e})]}),es=({discussionId:e})=>l.get(`/discussions/${e}`),S=({discussionId:e,config:t})=>f({...t,queryKey:["discussion",e],queryFn:()=>es({discussionId:e})}),ts=({data:e,discussionId:t})=>l.patch(`/discussions/${t}`,e),is=({config:e}={})=>{const{addNotification:t}=m(),i=h();return y({onMutate:async n=>{await i.cancelQueries(["discussion",n==null?void 0:n.discussionId]);const a=i.getQueryData(["discussion",n==null?void 0:n.discussionId]);return i.setQueryData(["discussion",n==null?void 0:n.discussionId],{...a,...n.data,id:n.discussionId}),{previousDiscussion:a}},onError:(n,a,r)=>{r!=null&&r.previousDiscussion&&i.setQueryData(["discussion",r.previousDiscussion.id],r.previousDiscussion)},onSuccess:n=>{i.refetchQueries(["discussion",n.id]),t({type:"success",title:"Discussion Updated"})},...e,mutationFn:ts})},ns=D({title:d().min(1,"Required"),body:d().min(1,"Required")}),rs=({discussionId:e})=>{var n,a;const t=S({discussionId:e}),i=is();return s.jsx(j,{allowedRoles:[C.ADMIN],children:s.jsx(w,{isDone:i.isSuccess,triggerButton:s.jsx(c,{startIcon:s.jsx(z,{className:"h-4 w-4"}),size:"sm",children:"Update Discussion"}),title:"Update Discussion",submitButton:s.jsx(c,{form:"update-discussion",type:"submit",size:"sm",isLoading:i.isLoading,children:"Submit"}),children:s.jsx(p,{id:"update-discussion",onSubmit:async r=>{await i.mutateAsync({data:r,discussionId:e})},options:{defaultValues:{title:(n=t.data)==null?void 0:n.title,body:(a=t.data)==null?void 0:a.body}},schema:ns,children:({register:r,formState:o})=>s.jsxs(s.Fragment,{children:[s.jsx(Q,{label:"Title",error:o.errors.title,registration:r("title")}),s.jsx(v,{label:"Body",error:o.errors.body,registration:r("body")})]})})})})},as=()=>{const t=q().discussionId,i=S({discussionId:t});return i.isLoading?s.jsx("div",{className:"flex items-center justify-center w-full h-48",children:s.jsx(b,{size:"lg"})}):i.data?s.jsxs(s.Fragment,{children:[s.jsx(_,{title:i.data.title}),s.jsxs(L,{title:i.data.title,children:[s.jsx("span",{className:"text-xs font-bold",children:g(i.data.createdAt)}),i.data.author&&s.jsxs("span",{className:"ml-2 text-sm font-bold",children:["by ",i.data.author.firstName," ",i.data.author.lastName]}),s.jsxs("div",{className:"flex flex-col mt-6 space-y-16",children:[s.jsx("div",{className:"flex justify-end",children:s.jsx(rs,{discussionId:t})}),s.jsx("div",{children:s.jsx("div",{className:"overflow-hidden bg-white shadow sm:rounded-lg",children:s.jsx("div",{className:"px-4 py-5 sm:px-6",children:s.jsx("div",{className:"max-w-2xl mt-1 text-sm text-gray-500",children:s.jsx(N,{value:i.data.body})})})})}),s.jsx("div",{children:s.jsx(ss,{discussionId:t})})]})]})]}):null},os=({data:e})=>l.post("/discussions",e),cs=({config:e}={})=>{const{addNotification:t}=m(),i=h();return y({onMutate:async n=>{await i.cancelQueries(["discussions"]);const a=i.getQueryData(["discussions"]);return i.setQueryData(["discussions"],[...a||[],n.data]),{previousDiscussions:a}},onError:(n,a,r)=>{r!=null&&r.previousDiscussions&&i.setQueryData(["discussions"],r.previousDiscussions)},onSuccess:()=>{i.invalidateQueries(["discussions"]),t({type:"success",title:"Discussion Created"})},...e,mutationFn:os})},ls=D({title:d().min(1,"Required"),body:d().min(1,"Required")}),us=()=>{const e=cs();return s.jsx(j,{allowedRoles:[C.ADMIN],children:s.jsx(w,{isDone:e.isSuccess,triggerButton:s.jsx(c,{size:"sm",startIcon:s.jsx(R,{className:"h-4 w-4"}),children:"Create Discussion"}),title:"Create Discussion",submitButton:s.jsx(c,{form:"create-discussion",type:"submit",size:"sm",isLoading:e.isLoading,children:"Submit"}),children:s.jsx(p,{id:"create-discussion",onSubmit:async t=>{await e.mutateAsync({data:t})},schema:ls,children:({register:t,formState:i})=>s.jsxs(s.Fragment,{children:[s.jsx(Q,{label:"Title",error:i.errors.title,registration:t("title")}),s.jsx(v,{label:"Body",error:i.errors.body,registration:t("body")})]})})})})},ds=()=>l.get("/discussions"),ms=({config:e}={})=>f({...e,queryKey:["discussions"],queryFn:()=>ds()}),hs=({discussionId:e})=>l.delete(`/discussions/${e}`),ys=({config:e}={})=>{const{addNotification:t}=m(),i=h();return y({onMutate:async n=>{await i.cancelQueries([["discussions"]]);const a=i.getQueryData(["discussions"]);return i.setQueryData(["discussions"],a==null?void 0:a.filter(r=>r.id!==n.discussionId)),{previousDiscussions:a}},onError:(n,a,r)=>{r!=null&&r.previousDiscussions&&i.setQueryData(["discussions"],r.previousDiscussions)},onSuccess:()=>{i.invalidateQueries(["discussions"]),t({type:"success",title:"Discussion Deleted"})},...e,mutationFn:hs})},js=({id:e})=>{const t=ys();return s.jsx(j,{allowedRoles:[C.ADMIN],children:s.jsx(F,{icon:"danger",title:"Delete Discussion",body:"Are you sure you want to delete this discussion?",triggerButton:s.jsx(c,{variant:"danger",startIcon:s.jsx(M,{className:"h-4 w-4"}),children:"Delete Discussion"}),confirmButton:s.jsx(c,{isLoading:t.isLoading,type:"button",className:"bg-red-600",onClick:async()=>await t.mutateAsync({discussionId:e}),children:"Delete Discussion"})})})},xs=()=>{const e=ms();return e.isLoading?s.jsx("div",{className:"w-full h-48 flex justify-center items-center",children:s.jsx(b,{size:"lg"})}):e.data?s.jsx(I,{data:e.data,columns:[{title:"Title",field:"title"},{title:"Created At",field:"createdAt",Cell({entry:{createdAt:t}}){return s.jsx("span",{children:g(t)})}},{title:"",field:"id",Cell({entry:{id:t}}){return s.jsx(T,{to:`./${t}`,children:"View"})}},{title:"",field:"id",Cell({entry:{id:t}}){return s.jsx(js,{id:t})}}]}):null},fs=()=>s.jsxs(L,{title:"Discussions",children:[s.jsx("div",{className:"flex justify-end",children:s.jsx(us,{})}),s.jsx("div",{className:"mt-4",children:s.jsx(xs,{})})]}),gs=()=>s.jsxs(k,{children:[s.jsx(x,{path:"",element:s.jsx(fs,{})}),s.jsx(x,{path:":discussionId",element:s.jsx(as,{})}),s.jsx(x,{path:"*",element:s.jsx(E,{to:"."})})]});export{gs as DiscussionsRoutes};
